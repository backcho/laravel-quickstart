# 03. 예제: 서비스 (인증 + 게시판)

> 목표: AI에게 요청할 서비스 영역 기능 명세

이 문서는 AI에게 기능 구현을 요청할 때 사용하는 **명세서**입니다.

---

## 1. 인증 시스템

### 패키지 설치

```bash
# laravel/ui 설치
composer require laravel/ui

# Bootstrap 기반 인증 스캐폴딩
php artisan ui bootstrap --auth

# 프론트엔드 빌드
npm install && npm run build

# 마이그레이션
php artisan migrate
```

### 구현할 기능

#### 회원가입
- **경로**: `/register`
- **필드**:
  - 이름 (name): 필수, 최대 255자
  - 이메일 (email): 필수, 유효한 이메일, 고유값
  - 비밀번호 (password): 필수, 최소 8자, 확인 필드와 일치

#### 로그인
- **경로**: `/login`
- **필드**:
  - 이메일 (email)
  - 비밀번호 (password)
  - 로그인 유지 (remember): 선택
- **기능**:
  - 로그인 실패 시 에러 메시지 표시
  - 로그인 성공 시 대시보드(`/home`)로 리다이렉트

#### 로그아웃
- **경로**: `POST /logout`
- **기능**: 세션 종료 후 홈페이지로 리다이렉트

#### 비밀번호 재설정 (선택)
- **경로**: `/password/reset`
- **기능**: 이메일로 재설정 링크 발송

### 미들웨어 적용

```php
// 로그인 필요한 페이지
Route::middleware('auth')->group(function () {
    // 인증된 사용자만 접근 가능
});

// 게스트만 접근 가능 (로그인/회원가입 페이지)
Route::middleware('guest')->group(function () {
    // 비로그인 사용자만 접근 가능
});
```

---

## 2. 게시판

### 데이터베이스 설계

#### posts 테이블

| 컬럼 | 타입 | 설명 |
|------|------|------|
| id | bigint (PK) | 기본키 |
| user_id | bigint (FK) | 작성자 |
| title | string(255) | 제목 |
| content | text | 내용 |
| created_at | timestamp | 생성일시 |
| updated_at | timestamp | 수정일시 |

#### 마이그레이션

```bash
php artisan make:model Post -m
```

```php
// database/migrations/xxxx_create_posts_table.php
Schema::create('posts', function (Blueprint $table) {
    $table->id();
    $table->foreignId('user_id')->constrained()->onDelete('cascade');
    $table->string('title');
    $table->text('content');
    $table->timestamps();
});
```

### 모델

```php
// app/Models/Post.php
class Post extends Model
{
    protected $fillable = ['title', 'content', 'user_id'];

    public function user()
    {
        return $this->belongsTo(User::class);
    }
}

// app/Models/User.php에 추가
public function posts()
{
    return $this->hasMany(Post::class);
}
```

### 구현할 기능

#### 게시글 목록
- **경로**: `GET /posts`
- **접근**: 모든 사용자 (비로그인 포함)
- **기능**:
  - 페이지네이션 (10개씩)
  - 제목, 작성자, 작성일 표시
  - 최신순 정렬

#### 게시글 상세 보기
- **경로**: `GET /posts/{post}`
- **접근**: 모든 사용자
- **기능**:
  - 제목, 내용, 작성자, 작성일 표시
  - 본인 글인 경우 수정/삭제 버튼 표시

#### 게시글 작성
- **경로**: `GET /posts/create` (폼), `POST /posts` (저장)
- **접근**: 로그인 사용자만
- **필드**:
  - 제목 (title): 필수, 최대 255자
  - 내용 (content): 필수
- **기능**: 작성 완료 후 상세 페이지로 리다이렉트

#### 게시글 수정
- **경로**: `GET /posts/{post}/edit` (폼), `PUT /posts/{post}` (저장)
- **접근**: 본인만
- **필드**: 작성과 동일

#### 게시글 삭제
- **경로**: `DELETE /posts/{post}`
- **접근**: 본인만
- **기능**: 삭제 후 목록 페이지로 리다이렉트

### 라우트

```php
// routes/web.php
use App\Http\Controllers\PostController;

Route::resource('posts', PostController::class);
// 위 한 줄이 아래 라우트들을 자동 생성:
// GET    /posts           → index   (목록)
// GET    /posts/create    → create  (작성 폼)
// POST   /posts           → store   (저장)
// GET    /posts/{post}    → show    (상세)
// GET    /posts/{post}/edit → edit  (수정 폼)
// PUT    /posts/{post}    → update  (수정)
// DELETE /posts/{post}    → destroy (삭제)
```

### Policy (권한 체크)

```bash
php artisan make:policy PostPolicy --model=Post
```

```php
// app/Policies/PostPolicy.php
class PostPolicy
{
    // 수정 권한: 본인만
    public function update(User $user, Post $post): bool
    {
        return $user->id === $post->user_id;
    }

    // 삭제 권한: 본인만
    public function delete(User $user, Post $post): bool
    {
        return $user->id === $post->user_id;
    }
}
```

```php
// 컨트롤러에서 사용
public function edit(Post $post)
{
    $this->authorize('update', $post);
    return view('posts.edit', compact('post'));
}
```

### 컨트롤러

```php
// app/Http/Controllers/PostController.php
class PostController extends Controller
{
    public function __construct()
    {
        // create, store, edit, update, destroy는 로그인 필요
        $this->middleware('auth')->except(['index', 'show']);
    }

    public function index()
    {
        $posts = Post::with('user')
            ->latest()
            ->paginate(10);
        return view('posts.index', compact('posts'));
    }

    public function create()
    {
        return view('posts.create');
    }

    public function store(Request $request)
    {
        $validated = $request->validate([
            'title' => 'required|max:255',
            'content' => 'required',
        ]);

        $post = $request->user()->posts()->create($validated);

        return redirect()->route('posts.show', $post)
            ->with('success', '게시글이 작성되었습니다.');
    }

    public function show(Post $post)
    {
        return view('posts.show', compact('post'));
    }

    public function edit(Post $post)
    {
        $this->authorize('update', $post);
        return view('posts.edit', compact('post'));
    }

    public function update(Request $request, Post $post)
    {
        $this->authorize('update', $post);

        $validated = $request->validate([
            'title' => 'required|max:255',
            'content' => 'required',
        ]);

        $post->update($validated);

        return redirect()->route('posts.show', $post)
            ->with('success', '게시글이 수정되었습니다.');
    }

    public function destroy(Post $post)
    {
        $this->authorize('delete', $post);
        $post->delete();

        return redirect()->route('posts.index')
            ->with('success', '게시글이 삭제되었습니다.');
    }
}
```

---

## 3. 디렉토리 구조

구현 완료 후 예상되는 구조:

```
app/
├── Http/
│   └── Controllers/
│       ├── PostController.php
│       └── HomeController.php
├── Models/
│   ├── User.php
│   └── Post.php
└── Policies/
    └── PostPolicy.php

resources/views/
├── layouts/
│   └── app.blade.php
├── auth/
│   ├── login.blade.php
│   ├── register.blade.php
│   └── passwords/
├── posts/
│   ├── index.blade.php
│   ├── show.blade.php
│   ├── create.blade.php
│   └── edit.blade.php
└── home.blade.php
```

---

## 4. AI에게 요청하는 프롬프트 예시

```
Laravel 11 프로젝트에서 다음 기능을 구현해주세요:

1. laravel/ui로 인증 시스템 설치 (Bootstrap)
2. Post 모델과 마이그레이션 생성
3. PostController (리소스 컨트롤러)
4. PostPolicy (본인만 수정/삭제)
5. posts 관련 Blade 뷰 파일들

게시판 요구사항:
- 목록은 페이지네이션 10개씩
- 최신순 정렬
- 비로그인도 목록/상세 조회 가능
- 로그인해야 작성 가능
- 본인 글만 수정/삭제 가능
```

---

## 다음 단계

서비스 기능이 완성되었습니다! [04_예제_백오피스.md](./04_예제_백오피스.md)에서 관리자 페이지를 구현합니다.
